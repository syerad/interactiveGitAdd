#if 0
	shc Version 3.8.7, Generic Script Compiler
	Copyright (c) 1994-2009 Francisco Rosales <frosal@fi.upm.es>

	shc -v -f interactiveGitadd.sh 
#endif

static  char data [] = 
#define      opts_z	1
#define      opts	((&data[0]))
	"\223"
#define      chk2_z	19
#define      chk2	((&data[1]))
	"\067\365\031\122\116\107\033\320\145\227\316\227\314\276\374\171"
	"\072\002\240\014"
#define      lsto_z	1
#define      lsto	((&data[21]))
	"\167"
#define      chk1_z	22
#define      chk1	((&data[24]))
	"\373\371\233\004\173\114\131\304\266\003\152\172\037\247\073\106"
	"\221\063\263\176\013\042\047\105\030\352\040\353"
#define      msg1_z	42
#define      msg1	((&data[56]))
	"\254\362\124\252\201\320\060\225\016\054\055\325\327\347\056\342"
	"\343\321\041\330\123\016\317\146\073\257\254\050\165\056\333\356"
	"\333\370\005\212\057\346\364\350\144\041\167\204\052\121\260\064"
	"\342\307\235\255\202\305"
#define      msg2_z	19
#define      msg2	((&data[106]))
	"\263\004\051\113\030\220\024\240\256\011\156\277\367\122\244\164"
	"\252\376\007\032\374"
#define      tst1_z	22
#define      tst1	((&data[125]))
	"\375\357\204\125\213\327\326\137\214\112\350\031\144\366\223\046"
	"\145\350\323\067\236\073\367\371\224"
#define      pswd_z	256
#define      pswd	((&data[154]))
	"\021\375\234\247\027\242\364\117\024\311\046\355\343\002\251\017"
	"\237\005\002\377\227\234\226\360\301\175\103\366\313\176\141\352"
	"\225\204\010\254\047\374\374\074\306\043\052\251\045\323\271\304"
	"\331\274\304\160\130\133\140\032\330\244\020\243\042\162\216\267"
	"\367\226\144\037\222\141\133\130\204\206\002\251\131\274\156\062"
	"\170\063\243\321\216\003\353\146\250\374\012\312\156\230\202\146"
	"\056\346\205\301\110\341\032\314\147\035\166\301\331\345\364\122"
	"\030\227\043\246\233\017\015\103\013\027\015\172\260\217\341\337"
	"\166\146\241\276\110\273\213\260\331\001\162\262\346\146\004\376"
	"\375\050\245\230\067\262\333\102\312\351\275\172\171\236\132\357"
	"\005\373\256\116\266\071\377\217\073\161\102\042\327\107\041\325"
	"\157\306\155\247\171\111\352\103\062\247\275\253\106\030\233\113"
	"\023\112\231\311\203\230\131\277\012\234\342\341\343\003\266\123"
	"\311\044\372\103\156\345\206\240\214\104\114\322\134\350\036\157"
	"\062\270\071\266\121\222\165\133\057\127\075\022\133\364\145\045"
	"\030\140\150\206\105\356\047\322\062\164\245\217\134\303\376\217"
	"\173\067\105\314\216\110\231\343\363\033\263\326\343\121\204\146"
	"\026\053\374\102\337\001\307\005\232\276\376\056\257\021\256\300"
	"\016\112\147\235"
#define      rlax_z	1
#define      rlax	((&data[442]))
	"\371"
#define      text_z	1707
#define      text	((&data[491]))
	"\136\000\205\342\146\234\016\142\336\355\143\245\363\375\143\361"
	"\054\022\003\332\323\021\045\073\257\271\074\060\100\132\144\236"
	"\132\351\201\300\205\217\042\144\174\206\011\157\204\155\141\261"
	"\152\204\303\002\227\244\123\102\170\350\026\300\362\131\341\045"
	"\225\266\374\373\312\170\364\245\370\051\205\140\310\137\370\325"
	"\140\221\147\333\354\211\140\170\072\064\275\047\063\245\364\140"
	"\012\307\255\373\271\320\273\152\256\110\100\254\011\367\163\367"
	"\264\254\041\320\060\175\112\055\165\033\217\305\221\167\007\011"
	"\311\242\323\236\054\327\321\304\027\070\044\265\167\052\223\331"
	"\311\360\223\333\006\253\242\300\071\143\063\267\204\272\123\303"
	"\162\120\326\152\014\104\070\216\205\347\006\070\076\062\065\332"
	"\225\055\145\216\104\306\032\324\155\175\073\260\061\100\317\371"
	"\277\304\270\052\064\073\233\023\256\102\133\052\121\211\353\002"
	"\346\210\254\362\116\340\173\377\350\222\341\315\377\051\264\245"
	"\373\127\134\271\332\234\363\264\255\016\222\173\250\364\077\144"
	"\036\123\373\253\116\362\036\230\134\060\114\376\040\327\324\156"
	"\331\020\041\145\316\241\066\360\270\236\230\202\307\030\000\304"
	"\053\120\264\352\354\322\002\335\164\374\122\366\107\243\347\350"
	"\375\021\323\310\200\324\056\070\322\161\316\356\143\133\172\011"
	"\240\301\327\115\363\070\120\057\266\371\235\007\027\206\030\247"
	"\001\254\013\125\036\307\277\250\141\125\275\261\102\352\215\145"
	"\153\150\125\110\276\336\273\145\164\321\221\277\312\145\224\020"
	"\342\030\153\252\140\130\173\261\216\012\321\271\036\211\235\257"
	"\053\176\050\054\076\103\130\263\351\150\360\364\051\254\116\226"
	"\271\173\133\115\324\015\040\157\006\265\052\042\201\327\131\052"
	"\277\177\055\342\206\102\117\243\240\135\106\317\034\300\223\157"
	"\106\106\301\050\000\051\213\123\217\070\207\147\113\157\241\173"
	"\150\252\215\351\003\305\010\131\072\016\146\061\134\150\353\217"
	"\323\171\157\363\173\134\043\364\312\213\242\161\307\370\004\225"
	"\124\304\114\156\025\347\373\141\242\300\253\047\262\317\144\323"
	"\161\151\041\332\234\116\002\333\043\274\110\321\323\303\077\212"
	"\275\155\113\241\121\147\015\202\172\213\230\240\072\166\060\007"
	"\310\272\213\110\107\012\036\343\004\067\061\101\256\153\165\135"
	"\012\276\066\013\013\333\267\326\075\056\276\352\340\374\110\376"
	"\004\312\142\307\155\353\231\071\134\304\060\155\100\160\212\131"
	"\031\300\354\041\252\062\232\114\320\074\211\344\161\012\003\044"
	"\113\053\160\025\074\371\167\254\325\124\126\317\054\066\065\272"
	"\371\256\023\045\003\024\076\017\367\050\222\001\072\230\036\102"
	"\075\004\345\015\115\231\375\340\374\005\370\132\013\326\322\010"
	"\010\221\270\141\376\160\170\260\222\313\102\314\162\221\140\227"
	"\017\136\256\337\141\065\206\332\006\130\116\164\031\162\112\203"
	"\356\240\035\270\166\236\270\335\117\262\347\342\151\032\265\103"
	"\307\210\300\152\151\052\150\146\033\160\276\007\366\167\056\002"
	"\072\133\251\047\364\260\354\377\277\355\340\350\131\243\001\077"
	"\334\044\352\161\146\216\010\106\143\304\155\370\327\207\122\157"
	"\211\345\362\333\312\024\025\110\201\240\056\174\363\144\032\233"
	"\372\025\054\012\306\164\113\075\324\027\161\116\076\222\360\113"
	"\135\050\102\305\306\260\125\231\210\013\203\145\011\215\035\174"
	"\362\162\110\026\202\112\171\236\311\074\177\107\277\365\122\046"
	"\051\142\152\106\117\275\021\026\201\230\002\021\350\142\162\005"
	"\022\114\314\115\205\162\152\307\016\100\247\040\360\132\273\226"
	"\031\230\300\245\142\337\051\127\214\172\250\237\246\152\276\232"
	"\122\127\243\342\262\376\125\054\000\214\073\365\346\362\047\066"
	"\230\145\235\167\204\246\251\114\014\225\047\366\161\205\204\336"
	"\003\205\170\167\372\162\310\257\126\342\204\227\317\332\077\060"
	"\347\113\267\076\261\345\256\352\345\117\274\256\205\254\270\046"
	"\167\255\360\002\125\062\064\247\134\215\307\263\145\210\016\053"
	"\166\066\264\342\015\366\251\142\224\140\373\243\170\131\331\031"
	"\333\266\130\247\060\327\352\012\037\335\221\277\305\024\065\304"
	"\176\005\263\217\045\241\142\374\160\347\264\175\244\301\174\325"
	"\375\010\050\020\222\235\164\167\202\377\026\044\103\221\046\374"
	"\363\276\041\201\274\142\346\174\073\042\007\217\366\337\031\306"
	"\221\337\067\077\122\157\001\304\114\246\314\017\342\345\366\347"
	"\221\362\077\255\056\344\303\325\346\160\213\155\260\173\102\064"
	"\121\304\020\160\303\203\250\017\342\242\236\035\215\074\234\001"
	"\212\002\035\276\362\110\277\167\101\014\313\054\062\164\344\262"
	"\366\044\140\164\126\301\367\163\250\343\247\364\370\306\173\222"
	"\205\077\277\060\007\054\306\331\334\152\363\200\106\066\157\057"
	"\322\137\304\354\252\176\133\225\224\324\000\022\157\004\035\313"
	"\233\003\202\113\277\235\257\075\045\324\053\202\301\156\341\330"
	"\102\120\303\251\247\237\007\275\100\274\330\063\322\375\151\015"
	"\217\141\155\037\202\110\342\110\276\057\114\104\345\013\231\001"
	"\067\211\231\313\255\352\227\176\017\031\371\172\110\345\302\145"
	"\302\227\341\101\301\254\003\326\167\302\332\101\115\056\265\264"
	"\051\030\345\142\141\057\374\050\066\154\155\314\050\303\067\062"
	"\264\112\051\171\313\013\230\360\004\206\321\131\310\056\104\247"
	"\233\366\210\322\242\120\264\017\262\240\306\265\176\333\274\235"
	"\005\325\034\253\176\176\116\374\247\131\313\053\123\277\123\052"
	"\236\243\232\130\332\367\264\232\206\225\107\153\030\060\144\330"
	"\376\035\340\224\053\036\226\343\145\012\027\007\224\332\032\320"
	"\007\261\021\226\175\371\144\255\055\344\233\062\174\032\344\036"
	"\171\004\036\257\160\335\132\232\157\053\211\056\131\156\275\155"
	"\016\335\172\231\126\111\104\105\021\077\375\205\271\002\132\300"
	"\245\262\200\271\240\270\123\352\317\236\157\044\101\306\122\252"
	"\274\055\143\306\244\167\131\021\077\105\116\005\252\114\256\324"
	"\101\262\002\000\137\075\062\323\046\245\334\315\364\146\027\320"
	"\251\263\245\154\307\032\314\373\121\341\010\267\110\053\124\133"
	"\005\145\205\160\231\032\345\201\073\244\012\165\041\143\316\236"
	"\230\013\143\205\210\020\014\256\257\251\262\162\315\306\251\006"
	"\161\313\303\372\140\151\071\277\156\256\146\034\022\036\076\113"
	"\045\134\045\002\154\367\256\045\352\145\261\315\225\332\300\312"
	"\162\203\011\250\326\144\002\175\212\323\063\304\142\002\243\033"
	"\207\155\347\315\264\341\021\164\374\131\251\123\201\110\221\342"
	"\010\214\074\344\330\236\310\067\222\336\101\317\321\273\246\226"
	"\103\070\303\137\010\252\102\237\216\347\346\330\344\337\134\065"
	"\322\055\032\031\024\307\257\165\112\277\354\354\006\324\362\012"
	"\370\356\004\025\104\252\362\272\236\162\103\113\272\344\253\236"
	"\305\154\043\202\154\271\377\376\240\265\151\202\142\073\306\143"
	"\373\241\002\107\022\332\206\054\315\356\055\276\057\200\044\315"
	"\157\100\072\305\276\134\120\051\104\331\343\353\037\116\057\006"
	"\061\275\321\263\236\307\026\106\245\110\200\275\175\164\346\210"
	"\135\056\126\327\227\117\316\203\352\147\033\135\316\204\223\134"
	"\217\021\025\066\206\264\127\034\153\354\345\345\300\100\250\040"
	"\306\147\013\115\277\361\110\225\225\172\102\070\077\052\173\032"
	"\335\310\131\303\064\077\341\144\067\123\052\046\010\066\350\341"
	"\145\330\076\070\255\150\055\043\252\037\276\202\112\240\203\302"
	"\102\273\032\003\176\177\255\341\216\140\140\170\117\352\237\101"
	"\225\031\273\341\270\035\354\014\240\012\212\102\216\116\321\301"
	"\111\132\260\246\114\370\316\103\017\065\304\115\236\276\130\126"
	"\016\142\056\207\146\205\006\162\316\224\034\200\144\213\123\166"
	"\261\217\046\152\314\126\253\046\272\111\200\244\313\100\052\132"
	"\142\216\327\351\230\106\155\005\250\036\205\015\252\330\204\134"
	"\150\252\306\064\001\161\132\274\273\332\140\206\032\213\341\175"
	"\032\270\146\262\377\324\267\247\363\074\265\236\025\071\372\175"
	"\344\301\261\345\063\014\241\356\346\002\165\001\215\127\176\247"
	"\017\345"
#define      xecc_z	15
#define      xecc	((&data[2285]))
	"\134\326\000\175\372\031\231\074\325\101\162\140\351\260\142\021"
	"\266"
#define      tst2_z	19
#define      tst2	((&data[2303]))
	"\113\154\361\212\153\206\051\054\345\270\322\041\332\245\266\002"
	"\061\222\247\345\143\245"
#define      inlo_z	3
#define      inlo	((&data[2324]))
	"\077\365\043"
#define      date_z	1
#define      date	((&data[2327]))
	"\271"
#define      shll_z	10
#define      shll	((&data[2329]))
	"\051\230\205\073\242\043\116\316\143\337\255"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !defined(TRACEABLE)

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !defined(TRACEABLE) */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		if (text_z < hide_z) {
			/* Prepend spaces til a hide_z script size. */
			scrpt = malloc(hide_z);
			if (!scrpt)
				return 0;
			memset(scrpt, (int) ' ', hide_z);
			memcpy(&scrpt[hide_z - text_z], text, text_z);
		} else {
			scrpt = text;	/* Script text */
		}
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, argv[0]);
		} else {
			scrpt = argv[0];
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !defined(TRACEABLE)
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
